import json
from web3 import Web3

ganache_url = "http://127.0.0.1:7545"
web3 = Web3(Web3.HTTPProvider(ganache_url))
web3.eth.defaultAccount = web3.eth.accounts[0]

def deploy(abi, bytecode):
    Contract = web3.eth.contract(abi=abi, bytecode=bytecode)
    tx_hash = Contract.constructor().transact()
    address = web3.eth.get_transaction_receipt(tx_hash)['contractAddress']
    return address

abi = json.loads('[{"constant":true,"inputs":[{"name":"a","type":"uint256"}],"name":"add1","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"num","type":"uint256"}],"name":"double","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}]')
# bytecode = '608060405234801561001057600080fd5b5061012f806100206000396000f300608060405260043610603e5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166700000000000000c1565b600080fd5b348015604e57600080fd5b506058600435606a565b60408051918252519081900360200190f35b6001019056005b34609f565b57600080fd5b5060586100aa565b565b60408051918252519081900360200190f35b60b6565b56005b8015604e602e016076565b600435606a602e016084565b60020290602e01609c565b63a836572881146043578063eee9720614607157603e56a165627a7a723058201b5930ac885210ff114b55848f959850c81886c515ec221eb475490f85e319a50029a165627a7a72305820f3a6ecd64c261907682d5ce13a40341199a16032194121592a8017e6692158de0029'
bytecode = '608060405234801561001057600080fd5b50610118806100206000396000f300608060405260043610603e5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166700000000000000aa565b600080fd5b348015604e57600080fd5b506058600435606a565b60408051918252519081900360200190f35b6001019056005b348015607c57600080fd5b5060586004356098565b60408051918252519081900360200190f35b609f565b56005b60020290602e01609c565b63a836572881146043578063eee9720614607157603e56a165627a7a723058201b5930ac885210ff114b55848f959850c81886c515ec221eb475490f85e319a50029a165627a7a72305820f3a6ecd64c261907682d5ce13a40341199a16032194121592a8017e6692158de0029'
contractAddress = deploy(abi, bytecode)

contract = web3.eth.contract(address=contractAddress, abi=abi)  # 创建一个合约
a = contract.functions.double(2).call()      # 当无需 gas 时直接使用 call 即可读取
b = contract.functions.add1(2).call()
print(a,b)

